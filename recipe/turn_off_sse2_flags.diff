From 539bc82650a1d75ca7618ade28d2d1d0a9fa0a70 Mon Sep 17 00:00:00 2001
From: ngam <67342040+ngam@users.noreply.github.com>
Date: Wed, 13 Jul 2022 15:21:33 +0000
Subject: [PATCH 1/2] turn off sse2 flags for osxarm64

---
 cmake/VWFlags.cmake | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/cmake/VWFlags.cmake b/cmake/VWFlags.cmake
index d533b5e5a7..5924f81b59 100644
--- a/cmake/VWFlags.cmake
+++ b/cmake/VWFlags.cmake
@@ -12,9 +12,9 @@ if(LTO)
   set(VW_LINUX_FLAGS ${VW_LINUX_FLAGS} -flto=thin)
 endif()
 
-if("${CMAKE_SYSTEM_PROCESSOR}" STREQUAL "x86_64")
-  set(LINUX_X86_64_OPT_FLAGS -msse2 -mfpmath=sse)
-endif()
+# if("${CMAKE_SYSTEM_PROCESSOR}" STREQUAL "x86_64")
+#   set(LINUX_X86_64_OPT_FLAGS -msse2 -mfpmath=sse)
+# endif()
 
 # Add -ffast-math for speed, remove for testability.
 # no-stack-check is added to mitigate stack alignment issue on Catalina where there is a bug with aligning stack-check instructions, and stack-check became default option

From 5cab43a5e1f8145e49deefac6d4d2083514cf7c8 Mon Sep 17 00:00:00 2001
From: ngam <67342040+ngam@users.noreply.github.com>
Date: Wed, 13 Jul 2022 16:14:00 -0400
Subject: [PATCH 2/2] use more cmake args

---
 setup.py | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/setup.py b/setup.py
index c05b4ace3f..5f17ee6971 100644
--- a/setup.py
+++ b/setup.py
@@ -82,6 +82,11 @@ def build_cmake(self, ext):
             "-DBUILD_PYTHON=On",
             "-DBUILD_TESTING=Off",
             "-DWARNINGS=Off",
+            "-DRAPIDJSON_SYS_DEP=On",
+            "-DFMT_SYS_DEP=On",
+            "-DSPDLOG_SYS_DEP=On",
+            "-DVW_BOOST_MATH_SYS_DEP=On",
+            "-DVW_ZLIB_SYS_DEP=On",
         ]
 
         # This doesn't work as expected for Python3.6 and 3.7 on Windows.
